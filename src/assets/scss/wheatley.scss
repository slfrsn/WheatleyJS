// Variables
$portal-color-blue: #7cb6ff;
$portal-color-orange: #F4AF3F;

// contrast(1.4) saturate(1.4) brightness(0.9)

// Functions
@function adjust-lightness($color, $gamma) {
  @if $gamma <= -1% { $color: darken($color, $gamma * -1); }
	@if $gamma >=  1% { $color: lighten($color, $gamma); }
	@if $gamma >=  0% { $color: $color; }
  @return darken(saturate($color, 100%), 10%);
}

// Mixins
@mixin portal-entrance($color, $gamma) {
  $adjusted-color: adjust-lightness($color, $gamma);
  background-color: adjust-lightness($adjusted-color, -50%);
}
@mixin portal-gradient($color, $gamma) {
  $adjusted-color: adjust-lightness($color, $gamma);
  background: radial-gradient(ellipse,
    adjust-lightness($adjusted-color, -60%) 10%,
    adjust-lightness($adjusted-color, -59%) 20%,
    adjust-lightness($adjusted-color, -53%) 42%,
    adjust-lightness($adjusted-color, -48%) 58%,
    adjust-lightness($adjusted-color, -40%) 100%
  );
}
@mixin portal-layer($scale-x, $scale-y, $gamma, $rotation, $duration, $timing) {
  width: 100% * $scale-x;
  height: 100% * $scale-y;
  transform: translate(-50%, -50%) rotate($rotation);
  animation-duration: $duration !important;
  animation-timing-function: $timing !important;
  #blue-portal & { background: adjust-lightness($portal-color-blue, $gamma); }
  #blue-portal.high-quality & { box-shadow: 0 0 20px rgba(adjust-lightness($portal-color-blue, $gamma), 0.4); }
  #orange-portal & { background: adjust-lightness($portal-color-orange, $gamma); }
  #orange-portal.high-quality & { box-shadow: 0 0 20px rgba(adjust-lightness($portal-color-orange, $gamma), 0.4); }
}

// BODY STYLES

.portal-gun-active {
	user-select: none !important;
	cursor: none !important;
}

// PORTAL GUN STYLES

#portal-gun {
	position: absolute;
	z-index: 9;
  background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 138 177" xmlns="http://www.w3.org/2000/svg"><circle cx="961.2" cy="580.7" r="1.9" fill="#aaa" transform="translate(-508.354 -259.685) scale(.6016)"/><circle cx="961.2" cy="580.7" r="1.9" fill="#aaa" transform="translate(-508.354 -280.21) scale(.6016)"/><circle cx="961.2" cy="580.7" r="1.9" fill="#aaa" transform="translate(-508.28 -239.86) scale(.6016)"/><circle cx="961.2" cy="580.7" r="1.9" fill="#aaa" transform="translate(-532.125 -259.685) scale(.6016)"/><circle cx="961.2" cy="580.7" r="1.9" fill="#aaa" transform="translate(-484.133 -259.685) scale(.6016)"/><path d="M896.3 630.4c-13.5-78 44.6-146 99.5-99.4 10 8.5 4.6 8-2.6 5.2-45-18.4-89 38.6-89.6 94.7 0 17-4.5 15.2-7.3-1z" fill="none" stroke-width="3.5" stroke="#7cb6ff" transform="matrix(.9792 0 0 1.0215 -872.663 -523.762)"/><path d="M896.3 630.4c-13.5-78 44.6-146 99.5-99.4 10 8.5 4.6 8-2.6 5.2-45-18.4-89 38.6-89.6 94.7 0 17-4.5 15.2-7.3-1z" fill="none" stroke-width="3.5" stroke="#f9ba4c" transform="matrix(-.9792 0 0 -1.0215 1010.215 700.685)"/></svg>') no-repeat;
  width: 125px;
  height: 125px;
	pointer-events: none;
  &.blue:before, &.orange:after {
    content: '';
    width: 100%;
    height: 100%;
    position: absolute;
  }
  &.blue:before {
    background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 138 177" xmlns="http://www.w3.org/2000/svg"><path d="M8 118.4C0 51.8 40.6-18.6 95 18.2 53 5 10.7 56.7 8 118.4z" fill="#7cb6ff"/></svg>') no-repeat;
  }
  &.orange:after {
    background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 138 177" xmlns="http://www.w3.org/2000/svg"><path d="M129.5 58.5c8.2 66.6-32.4 137-87 100.3 42.3 13.2 84.4-38.6 87-100.3z" fill="#f9ba4c"/></svg>') no-repeat;
  }
}

// PORTAL STYLES

.portal {
  position: absolute;
	width: 100px;
	height: 100px;
  transform: scaleY(1.3);
  // &.drop { filter:  saturate(1.8) contrast(1.1); }
  & > div {
    position: absolute;
    margin-top: 50%;
    margin-left: 50%;
    border-radius: 50%;
    &:not(.entrance) { filter: contrast(1.4); }
  }
}
.darkest  { @include portal-layer(0.90, 1.00, -15%,  90deg, 0.8s, linear); }
.darker   { @include portal-layer(0.90, 1.00, -10%,  45deg, 0.2s, linear); }
.normal   { @include portal-layer(0.90, 1.00,   0%,   0deg, 0.5s, linear); }
.lighter  { @include portal-layer(0.90, 1.00,  10%, -45deg, 1.1s, linear); }
.lightest { @include portal-layer(0.90, 1.00,  15%, -90deg, 0.8s, linear); }
.entrance { @include portal-layer(0.87, 0.85, -60%,   0deg, 0.1s, ease);
  box-shadow: 0 0 20px #fff !important;
  #blue-portal &                { @include portal-entrance($portal-color-blue, 8%); }
  #blue-portal.high-quality &   { @include portal-gradient($portal-color-blue, 8%); }
  #orange-portal &              { @include portal-entrance($portal-color-orange, 15%); }
  #orange-portal.high-quality & { @include portal-gradient($portal-color-orange, 15%); }
  // .high-quality &:after {
	// 	content: '';
	// 	position: absolute;
	// 	top:0;
	// 	left: 0;
  //   width: 100%;
  //   height: 100%;
  //   opacity: 0.4;
  //   background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" stroke-miterlimit="1.4" viewBox="0 0 825 826" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><g fill="none" stroke="#000" stroke-width="4" stroke-dasharray="80 400 200 400"><ellipse cx="412.2" cy="412.7" stroke-dashoffset="120" rx="201.3" ry="201.5"/><ellipse cx="412.2" cy="412.7" rx="127.9" ry="128.1"/><ellipse cx="412.2" cy="412.7" stroke-dashoffset="40" rx="63.5" ry="63.6"/><ellipse cx="412.2" cy="412.7" stroke-dashoffset="40" rx="248.6" ry="249"/><ellipse cx="412.2" cy="412.7" stroke-dashoffset="40" rx="324.1" ry="324.5"/><ellipse cx="412.2" cy="412.7" stroke-dashoffset="40" rx="408.7" ry="409.2"/></g><g fill="none" stroke="#000" stroke-width="4" stroke-dasharray="80 400 200 400"><path stroke-dashoffset="200" d="M570.2 340.6c39.7 87 1.2 190-86 230-87.2 39.7-190.3 1.3-230-85.8-39.8-87-1.3-190 86-230 87-39.7 190.2-1.3 230 85.8z"/><path stroke-dashoffset="-400" d="M512.6 367c25.3 55.2.8 120.7-54.6 146-55.5 25.3-121 1-146.3-54.5-25.2-55.3-.8-120.8 54.7-146 26.3-12 55-13 80.4-4.5 28.2 9.2 52.5 29.8 65.8 59z"/><path stroke-dashoffset="20" d="M462 390c12.5 27.4.4 60-27 72.5-27.6 12.5-60 .4-72.7-27-12.5-27.5-.4-60 27-72.6 27.7-12.6 60.2-.5 72.7 27z"/><path stroke-dashoffset="80" d="M607.4 323.6c49 107.6 1.5 235-106.3 284-107.6 49.2-235 1.8-284-105.8s-1.6-235 106.2-284c107.7-49.2 235-1.8 284.2 105.8z"/><path stroke-dashoffset="20" d="M666.6 296.6c64 140.2 2 306-138.5 370.2-140.3 64-306.3 2.3-370.3-138-64-140.2-2-306 138.5-370.2 140.4-64 306.4-2.3 370.4 138z"/><path stroke-dashoffset="20" d="M733 266.2c80.8 177 2.5 386-174.6 467-177 80.8-386.4 2.8-467-174-80.8-177-2.6-386 174.5-467 177-80.8 386.3-2.8 467 174z"/></g></svg>');
  // }
}

// ANIMATIONS
@mixin use-animation($name) {
	animation-name: $name;
	animation-duration: 0.2s;
	animation-timing-function: ease;
}
.spin > div {
  @include use-animation('spin');
  animation-iteration-count: infinite;
}
@keyframes spin {
  0%   { transform: translate(-50%, -50%) rotate(  0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

// .fire { @include use-animation('fire'); }
// @keyframes fire {
//   0%   { transform: translate( 0px, 0px) rotate( 0deg); }
//   20%  { transform: translate(50px, 8px) rotate(10deg); }
//   100% { transform: translate( 0px, 0px) rotate( 0deg); }
// }
//
// .misfire { @include use-animation('misfire'); }
// @keyframes misfire {
//   0%   { transform: rotate( 0deg); }
//   25%  { transform: rotate( 3deg); }
//   40%  { transform: rotate(-3deg); }
//   50%  { transform: rotate( 3deg); }
//   100% { transform: rotate( 0deg); }
// }

.appear { @include use-animation('appear'); }
@keyframes appear {
  0%   { transform: scale( 0,   0); opacity:   0; }
  25%  { transform: scale(.8, 1.2); opacity: .25; }
  50%  { transform: scale(.9, 1.1); opacity: .50; }
  100% { transform: scale( 1, 1.3); opacity:   1; }
}

.disappear { @include use-animation('disappear'); }
@keyframes disappear {
  0%   { transform: scale( 1, 1.3); opacity:   1; }
  25%  { transform: scale(.8, 1.1); opacity: .75; }
  50%  { transform: scale(.9, 1.2); opacity: .25; }
  100% { transform: scale( 0,   0); opacity:   0; }
}
